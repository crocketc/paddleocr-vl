# PaddleOCR-VL 配置指南

本文档详细说明 `scripts/config.yaml` 中所有可配置参数的含义和使用方法。

---

## 配置文件结构

```yaml
presets:          # 预设模式配置
options:          # 用户自定义参数（会覆盖预设）
output:           # 输出配置
api:              # API 配置
```

---

## 文档矫正参数

### use_doc_orientation_classify

**图片方向矫正**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：自动识别并矫正 0°、90°、180°、270° 的图片方向
- **适用场景**：
  - 扫描文档方向不正确
  - 照片拍摄的文档角度不对
- **建议**：处理扫描件时建议开启

### use_doc_unwarping

**图片扭曲矫正**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：矫正褶皱、弯曲、倾斜等扭曲情况
- **适用场景**：
  - 书籍拍照产生的弯曲
  - 纸张褶皱
  - 拍摄角度倾斜

---

## 版面检测参数

### use_layout_detection

**版面区域检测**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：自动检测文档中的不同区域（标题、段落、表格、图片等）并排序
- **建议**：复杂版面文档务必开启

### layout_threshold

**检测得分阈值**

- **类型**：浮点数
- **取值范围**：0.1 ~ 1.0
- **默认值**：0.5
- **说明**：控制版面检测的严格程度
  - 值越大：检测越严格，可能漏检
  - 值越小：检测越宽松，可能误检
- **调优建议**：
  - 漏检区域：降低阈值（如 0.3）
  - 误检过多：提高阈值（如 0.7）

### layout_nms

**NMS 后处理**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：移除重复或高度重叠的区域框
- **建议**：一般保持开启

### layout_unclip_ratio

**检测框扩张系数**

- **类型**：浮点数
- **默认值**：1.0
- **说明**：控制检测框的扩张程度
- **适用场景**：文字被截断时可适当调高

### layout_merge_bboxes_mode

**重叠框过滤方式**

- **类型**：字符串
- **可选值**：
  - `large`：保留大框
  - `small`：保留小框
  - `union`：都保留
- **默认值**：`null`（使用 API 默认）

### layout_shape_mode

**几何形状表示模式**

- **类型**：字符串
- **可选值**：
  - `rect`：矩形
  - `quad`：四边形
  - `poly`：多边形
  - `auto`：自动选择
- **默认值**：`null`（使用 API 默认）

---

## 内容识别参数

### use_chart_recognition

**图表识别**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：解析柱状图、饼图、折线图等并转为表格
- **适用场景**：文档中包含统计图表时开启

### prompt_label

**Prompt 类型**

- **类型**：字符串
- **可选值**：`ocr` / `formula` / `table` / `chart` / `null`
- **说明**：仅在 `use_layout_detection=false` 时生效
- **用途**：指定识别任务的类型

---

## 推理参数

### repetition_penalty

**重复抑制强度**

- **类型**：浮点数
- **取值范围**：1.0 ~ 2.0
- **说明**：控制结果中重复内容的抑制程度
- **调优建议**：
  - 结果出现大量重复：调高（如 1.5）
  - 正常情况：使用默认值

### temperature

**识别稳定性**

- **类型**：浮点数
- **取值范围**：0.1 ~ 1.0
- **说明**：控制输出的随机性
- **调优建议**：
  - 结果不稳定：调低（如 0.3）
  - 漏识别：调高（如 0.8）

### top_p

**结果可信范围**

- **类型**：浮点数
- **取值范围**：0.1 ~ 1.0
- **说明**：核采样参数，控制结果的可信范围
- **调优建议**：
  - 结果发散：调低（如 0.5）
  - 正常情况：使用默认值

### min_pixels

**最小图像尺寸**

- **类型**：整数
- **说明**：输入图像的最小像素数
- **适用场景**：小图片识别失败时调高

### max_pixels

**最大图像尺寸**

- **类型**：整数
- **说明**：输入图像的最大像素数
- **适用场景**：大图片处理缓慢时调低

---

## 输出格式参数

### show_formula_number

**公式编号展示**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：Markdown 输出中是否包含公式编号

### restructure_pages

**多页结果重构**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：用于跨页表格合并和标题级别识别
- **建议**：多页 PDF 文档建议开启

### merge_tables

**跨页表格合并**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：将跨页分割的表格合并为一个完整表格
- **依赖**：需要 `restructure_pages=true`

### relevel_titles

**标题级别识别**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：自动识别段落标题的层级（H1, H2, H3...）
- **依赖**：需要 `restructure_pages=true`

### prettify_markdown

**Markdown 美化**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：输出美化后的 Markdown 格式

### visualize

**可视化结果**

- **类型**：布尔值
- **可选值**：`true` / `false` / `null`
- **默认值**：由预设模式决定
- **说明**：返回可视化结果图
- **注意**：开启后会显著增加响应时间

---

## 输出配置

### output.format

**输出格式**

- **类型**：字符串
- **可选值**：
  - `markdown`：仅输出 Markdown 文件
  - `json`：仅输出 JSON 文件
  - `both`：同时输出 Markdown 和 JSON
- **默认值**：`markdown`

### output.json_file

**JSON 输出路径**

- **类型**：字符串
- **默认值**：`result.json`
- **说明**：当 `format=json` 或 `both` 时生效

### output.markdown_dir

**Markdown 输出目录**

- **类型**：字符串
- **默认值**：`output`
- **说明**：Markdown 文件的保存目录

---

## API 配置

### api.base_url

**API 端点地址**

- **类型**：字符串
- **默认值**：`https://aip.baidubce.com/rpc/2.0/ai_custom/v1/wenxinworkshop/plugin/ocr_vl`
- **说明**：通常不需要修改

### api.token

**API Token**

- **类型**：字符串
- **默认值**：`null`
- **说明**：可通过命令行参数或环境变量覆盖

### api.timeout

**请求超时时间**

- **类型**：整数（秒）
- **默认值**：300
- **说明**：大文件处理时可能需要调高

### api.max_retries

**最大重试次数**

- **类型**：整数
- **默认值**：3
- **说明**：请求失败时的自动重试次数

---

## 配置调优建议

### 简单文档（纯文本为主）

```yaml
use_layout_detection: false
use_chart_recognition: false
```

### 复杂文档（表格、图表、公式）

```yaml
use_layout_detection: true
use_chart_recognition: true
layout_threshold: 0.3
restructure_pages: true
merge_tables: true
```

### 扫描件（方向不正、有扭曲）

```yaml
use_doc_orientation_classify: true
use_doc_unwarping: true
```

### 识别不稳定时

```yaml
temperature: 0.3
top_p: 0.7
```

---

## 预设模式对比

| 参数 | 快速 | 标准 | 精细 |
|------|------|------|------|
| 方向矫正 | ❌ | ✅ | ✅ |
| 扭曲矫正 | ❌ | ✅ | ✅ |
| 版面检测 | ❌ | ✅ | ✅ |
| 图表识别 | ❌ | ❌ | ✅ |
| 表格合并 | ❌ | ❌ | ✅ |
| 标题识别 | ❌ | ❌ | ✅ |
| Markdown 美化 | ❌ | ❌ | ✅ |
